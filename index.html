<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RiskManager - Gestión de Riesgos Cyber</title>
    <link rel="stylesheet" href="style.css">
    <!-- Using FontAwesome for icons (CDN) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>

    <!-- Sidebar Navigation -->
    <nav class="sidebar">
        <div class="logo-area">
            <i class="fa-solid fa-shield-halved logo-icon"></i>
            <span>RiskManager</span>
        </div>
        <ul class="nav-links">
            <li><button class="nav-btn active" onclick="switchTab('dashboard')"><i class="fa-solid fa-chart-line"></i>
                    Dashboard</button></li>
            <li><button class="nav-btn" onclick="switchTab('assets')"><i class="fa-solid fa-server"></i>
                    Activos</button></li>
            <li><button class="nav-btn" onclick="switchTab('risks')"><i class="fa-solid fa-triangle-exclamation"></i>
                    Gestión de Riesgos</button></li>
            <li><button class="nav-btn" onclick="switchTab('treatment')"><i class="fa-solid fa-user-doctor"></i>
                    Tratamiento</button></li>
            <li><button class="nav-btn" onclick="switchTab('reports')"><i class="fa-solid fa-file-pdf"></i>
                    Reportes</button></li>
        </ul>
    </nav>

    <!-- Main Content -->
    <div class="main-content">
        <header>
            <h2 id="page-title">Dashboard General</h2>
            <div class="user-profile">
                <div class="notification-area" style="margin-right: 20px; position: relative; cursor: pointer;"
                    onclick="toggleNotifications()">
                    <i class="fa-solid fa-bell" style="font-size: 1.2rem;"></i>
                    <span id="notif-badge" class="badge-count" style="display:none;">0</span>
                    <div id="notif-dropdown" class="dropdown-menu">
                        <div class="dropdown-header">Notificaciones</div>
                        <ul id="notif-list">
                            <!-- Populated by JS -->
                        </ul>
                    </div>
                </div>
                <i class="fa-solid fa-circle-user"></i>
                <span>Admin User</span>
            </div>
        </header>

        <div class="content-area">

            <!-- DASHBOARD VIEW -->
            <div id="dashboard" class="view-section active">
                <div class="dashboard-grid">
                    <div class="card">
                        <h3>Total Activos</h3>
                        <div class="number" id="dash-total-assets">0</div>
                    </div>
                    <div class="card">
                        <h3>Riesgos Identificados</h3>
                        <div class="number" id="dash-total-risks">0</div>
                    </div>
                    <div class="card">
                        <h3>Riesgo Promedio</h3>
                        <div class="number" id="dash-avg-risk">0.0</div>
                    </div>
                    <div class="card">
                        <h3>Controles Implementados</h3>
                        <div class="number" id="dash-controls">0</div>
                    </div>
                </div>

                <div class="form-container">
                    <h3><i class="fa-solid fa-bullhorn"></i> Estado del Sistema</h3>
                    <p style="color: var(--text-secondary); margin-top: 10px;">
                        El sistema está operando correctamente. El cálculo de riesgos se basa en la metodología ISO/IEC
                        27005 alineada a controles 27002:2022.
                    </p>
                </div>
            </div>

            <!-- ASSETS VIEW -->
            <div id="assets" class="view-section">
                <div class="section-header">
                    <h2>Inventario de Activos</h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn" style="background-color: #f0ad4e; color: #fff;" onclick="syncWazuh()"><i
                                class="fa-solid fa-rotate"></i> Sincronizar Wazuh</button>
                        <button class="btn btn-primary" onclick="showAssetForm()"><i class="fa-solid fa-plus"></i> Nuevo
                            Activo</button>
                    </div>
                </div>

                <!-- Asset Form (Hidden by default) -->
                <div id="asset-form-card" class="form-container" style="display: none;">
                    <h3>Registrar Nuevo Activo</h3>
                    <form id="assetForm" onsubmit="addAsset(event)">
                        <div class="form-group">
                            <label>Nombre del Activo</label>
                            <input type="text" id="assetName" class="form-control"
                                placeholder="Ej: Servidor Web Principal" required>
                        </div>
                        <div class="form-group">
                            <label>Tipo</label>
                            <select id="assetType" class="form-control">
                                <option value="Hardware">Hardware</option>
                                <option value="Software">Software</option>
                                <option value="Datos">Datos / Información</option>
                                <option value="Personal">Personal</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Valoración (Confidencialidad, Integridad, Disponibilidad)</label>
                            <select id="assetValue" class="form-control">
                                <option value="1">Bajo (Uso interno)</option>
                                <option value="3">Medio (Operación diaria)</option>
                                <option value="5">Alto (Crítico para el negocio)</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Guardar Activo</button>
                        <button type="button" class="btn"
                            style="background: transparent; border: 1px solid var(--border-color); color: var(--text-primary);"
                            onclick="hideAssetForm()">Cancelar</button>
                    </form>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nombre</th>
                            <th>Tipo</th>
                            <th>Valoración</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="assets-table-body">
                        <!-- JS renders rows here -->
                    </tbody>
                </table>
            </div>

            <!-- RISKS VIEW -->
            <div id="risks" class="view-section">
                <div class="section-header">
                    <h2>Análisis de Riesgos</h2>
                    <button class="btn btn-primary" onclick="showRiskForm()"><i class="fa-solid fa-plus"></i> Nuevo
                        Riesgo</button>
                </div>

                <!-- Risk Form -->
                <div id="risk-form-card" class="form-container" style="display: none;">
                    <h3>Identificar Riesgo</h3>
                    <form id="riskForm" onsubmit="addRisk(event)">
                        <div class="form-group">
                            <label>Activo Afectado</label>
                            <select id="riskAssetSelect" class="form-control" required>
                                <!-- Populated by JS -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Amenaza / Vulnerabilidad</label>
                            <input type="text" id="riskThreat" class="form-control"
                                placeholder="Ej: Ataque DDoS por falta de firewall" required>
                        </div>
                        <div class="form-group">
                            <label>Probabilidad (1-5)</label>
                            <input type="number" id="riskProb" class="form-control" min="1" max="5" required>
                        </div>
                        <div class="form-group">
                            <label>Impacto (1-5)</label>
                            <input type="number" id="riskImpact" class="form-control" min="1" max="5" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Calcular y Guardar</button>
                        <button type="button" class="btn" onclick="hideRiskForm()"
                            style="background: transparent; border: 1px solid var(--border-color);">Cancelar</button>
                    </form>
                </div>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Activo</th>
                            <th>Amenaza</th>
                            <th>Prob x Imp</th>
                            <th>Nivel de Riesgo</th>
                        </tr>
                    </thead>
                    <tbody id="risks-table-body">
                        <!-- JS renders rows here -->
                    </tbody>
                </table>
            </div>

            <!-- TREATMENT VIEW -->
            <div id="treatment" class="view-section">
                <div class="section-header">
                    <h2>Tratamiento de Riesgos</h2>
                </div>
                <p style="margin-bottom: 20px; color: var(--text-secondary);">Aplique controles ISO 27002 para mitigar
                    los riesgos altos.</p>

                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Riesgo</th>
                            <th>Nivel Actual</th>
                            <th>Estrategia</th>
                            <th>Control Propuesto</th>
                            <th>Riesgo Residual</th>
                            <th>Acción</th>
                        </tr>
                    </thead>
                    <tbody id="treatment-table-body">
                        <!-- JS renders rows here -->
                    </tbody>
                </table>
            </div>

            <!-- REPORTS VIEW -->
            <div id="reports" class="view-section">
                <div class="section-header">
                    <h2>Reportes y Documentación</h2>
                </div>
                <div class="dashboard-grid">
                    <div class="card" style="cursor: pointer;">
                        <h3>Reporte Ejecutivo</h3>
                        <p style="font-size: 3rem; color: var(--accent-blue); text-align: center;"><i
                                class="fa-solid fa-file-invoice"></i></p>
                        <p style="text-align: center; margin-top: 10px;">Descargar PDF</p>
                    </div>
                    <div class="card" id="heatmap-card" style="grid-column: span 2;">
                        <h3>Mapa de Calor de Riesgos</h3>
                        <div id="heatmap-container" style="display: flex; justify-content: center; margin-top: 20px;">
                            <!-- JS renders Heatmap here -->
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- ROI VIEW -->
        <div id="roi" class="view-section">
            <div class="section-header">
                <h2>Análisis Costo-Beneficio (ROI)</h2>
            </div>
            <div class="dashboard-grid">
                <div class="card">
                    <h3>ALE Actual (Pérdida Anual)</h3>
                    <div class="number" style="color: var(--danger);">$<span id="roi-ale-current">0</span></div>
                </div>
                <div class="card">
                    <h3>Costo de Controles</h3>
                    <div class="number" style="color: var(--warning);">$<span id="roi-cost">0</span></div>
                </div>
                <div class="card">
                    <h3>Ahorro Proyectado</h3>
                    <div class="number" style="color: var(--success);">$<span id="roi-savings">0</span></div>
                </div>
                <div class="card">
                    <h3>ROI Estimado</h3>
                    <div class="number" id="roi-percent">0%</div>
                </div>
            </div>

            <div class="form-container">
                <h3>Calculadora de Retorno de Inversión</h3>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    Seleccione un riesgo tratado para estimar el ROI basado en la reducción de impacto financiero.
                </p>
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <div class="form-group" style="flex: 1;">
                        <label>Riesgo Tratado</label>
                        <select id="roiRiskSelect" class="form-control" onchange="calculateROI()">
                            <option value="">-- Seleccione Riesgo --</option>
                            <!-- Populated by JS -->
                        </select>
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>Costo del Control ($)</label>
                        <input type="number" id="controlCost" class="form-control" value="5000"
                            onchange="calculateROI()">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>Valor del Activo ($)</label>
                        <input type="number" id="assetValueMoney" class="form-control" value="50000"
                            onchange="calculateROI()">
                    </div>
                </div>
            </div>
        </div>

        <!-- Evidence Modal -->
        <div id="evidence-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal" onclick="closeEvidenceModal()">&times;</span>
                <h3>Gestión de Evidencias</h3>
                <p>Suba archivos (logs, capturas) que demuestren la implementación del control.</p>
                <div class="upload-area" id="drop-zone" onclick="document.getElementById('fileElem').click()">
                    <i class="fa-solid fa-cloud-arrow-up" style="font-size: 3rem; color: var(--accent-blue);"></i>
                    <p style="margin-top: 10px;">Arrastre archivos aquí o haga clic para subir</p>
                    <input type="file" id="fileElem" multiple style="display:none" onchange="handleFiles(this.files)">
                </div>
                <ul id="evidence-list" class="evidence-list">
                    <!-- Evidence items -->
                </ul>
                <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="saveEvidence()">Guardar
                    Evidencia</button>
            </div>
        </div>

    </div>
    </div>

    <!-- Scripts -->
    <script src="app.js"></script>
</body>

</html>